{
  "version": 3,
  "sources": ["../../commands/lockdown.ts"],
  "sourcesContent": ["import type {\n\tChatInputCommandInteraction,\n\tTextChannel,\n\tVoiceChannel,\n} from \"discord.js\";\nimport {\n\tSlashCommandBuilder,\n\tEmbedBuilder,\n\tColors,\n\tButtonBuilder,\n\tActionRowBuilder,\n\tButtonStyle,\n\tPermissionFlagsBits,\n} from \"discord.js\";\nimport {\n\tdefaultError,\n\terrorEmbedBuilder,\n\tsuccessEmbedBuilder,\n} from \"../utils.js\";\nimport prisma from \"../database.js\";\nimport emojis from \"../emojis.js\";\n\nexport default class Lockdown {\n\tdata = new SlashCommandBuilder()\n\t\t.setName(\"lockdown\")\n\t\t.setDescription(\"Lockdown the entire server!\")\n\t\t.setDefaultMemberPermissions(PermissionFlagsBits.Administrator)\n\t\t.addSubcommand((subcommand) =>\n\t\t\tsubcommand.setName(\"on\").setDescription(\"turn the lockdown on!\"),\n\t\t)\n\t\t.addSubcommand((subcommand) =>\n\t\t\tsubcommand.setName(\"off\").setDescription(\"turn the lockdown off!\"),\n\t\t)\n\t\t.addSubcommand((subcommand) =>\n\t\t\tsubcommand\n\t\t\t\t.setName(\"update\")\n\t\t\t\t.setDescription(\"Post an update on the lockdown!\")\n\t\t\t\t.addStringOption((message) =>\n\t\t\t\t\tmessage\n\t\t\t\t\t\t.setName(\"message\")\n\t\t\t\t\t\t.setDescription(\n\t\t\t\t\t\t\t\"The update message that will be posted during lockdown\",\n\t\t\t\t\t\t)\n\t\t\t\t\t\t.setRequired(true),\n\t\t\t\t),\n\t\t);\n\n\tasync run(interaction: ChatInputCommandInteraction) {\n\t\tif (!interaction.inGuild()) {\n\t\t\tawait interaction.reply({\n\t\t\t\tembeds: [\n\t\t\t\t\terrorEmbedBuilder(\"This command can only be run on a server!\"),\n\t\t\t\t],\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tconst tempGuild = await prisma.guild.findUnique({\n\t\t\twhere: { guild: interaction.guildId },\n\t\t\tselect: { owners: true },\n\t\t});\n\n\t\tif (\n\t\t\t!(\n\t\t\t\ttempGuild?.owners.includes(interaction.user.id) ||\n\t\t\t\tinteraction.guild?.ownerId === interaction.user.id\n\t\t\t)\n\t\t) {\n\t\t\tawait interaction.reply({\n\t\t\t\tembeds: [\n\t\t\t\t\terrorEmbedBuilder(\n\t\t\t\t\t\t\"Only an owner can use the </lockdown:1014153355330850855>.\",\n\t\t\t\t\t),\n\t\t\t\t],\n\t\t\t\tephemeral: true,\n\t\t\t});\n\t\t\treturn;\n\t\t}\n\n\t\tswitch (interaction.options.getSubcommand()) {\n\t\t\tcase \"on\":\n\t\t\t\tconst confirm = new ActionRowBuilder<ButtonBuilder>({\n\t\t\t\t\tcomponents: [\n\t\t\t\t\t\tnew ButtonBuilder({\n\t\t\t\t\t\t\tlabel: \"Continue\",\n\t\t\t\t\t\t\tstyle: ButtonStyle.Danger,\n\t\t\t\t\t\t\tcustom_id: \"lockdown_continue\",\n\t\t\t\t\t\t}),\n\t\t\t\t\t],\n\t\t\t\t});\n\n\t\t\t\tconst lockdownOnEmbed = new EmbedBuilder()\n\t\t\t\t\t.setTitle(`${emojis.warn}  Warning!`)\n\t\t\t\t\t.setDescription(`${emojis.reply1} Lockdown will lock every channel in your server, and kick everyone new that joins to your server.\n\t\t \n\t\t\t\t\t**__Note:__** We **aren't** responsible in any way for the damage this can cause to your server. Are you sure you want to continue?\n\t\t\t\t\t`)\n\t\t\t\t\t.setColor(0x2b2d31)\n\t\t\t\t\t.setFooter({\n\t\t\t\t\t\ttext: interaction.guild?.name ?? \"\",\n\t\t\t\t\t\ticonURL: interaction.guild?.iconURL() ?? \"\",\n\t\t\t\t\t});\n\n\t\t\t\tawait interaction.reply({\n\t\t\t\t\tembeds: [lockdownOnEmbed],\n\t\t\t\t\tcomponents: [confirm],\n\t\t\t\t\tephemeral: true,\n\t\t\t\t});\n\t\t\t\tbreak;\n\n\t\t\tcase \"off\":\n\t\t\t\ttry {\n\t\t\t\t\tawait interaction.deferReply({ ephemeral: true });\n\t\t\t\t\tconst guild = await prisma.guild.findUnique({\n\t\t\t\t\t\twhere: { guild: interaction.guildId },\n\t\t\t\t\t\tselect: {\n\t\t\t\t\t\t\tlockdownChannel: true,\n\t\t\t\t\t\t\tverificationChannel: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!guild?.lockdownChannel) {\n\t\t\t\t\t\tawait interaction.editReply({\n\t\t\t\t\t\t\tembeds: [\n\t\t\t\t\t\t\t\terrorEmbedBuilder(\n\t\t\t\t\t\t\t\t\t\"Lockdown has not been activated in this server!\",\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst lockdownChannel = await interaction.guild?.channels.fetch(\n\t\t\t\t\t\tguild?.lockdownChannel,\n\t\t\t\t\t);\n\t\t\t\t\tawait lockdownChannel?.delete(\"Lockdown has been turned off\");\n\n\t\t\t\t\tawait prisma.guild.update({\n\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\tguild: interaction.guildId,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tdata: {\n\t\t\t\t\t\t\traidMode: false,\n\t\t\t\t\t\t\tlockdownChannel: null,\n\t\t\t\t\t\t\tlockdownMessage: null,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tinteraction.guild?.channels.cache.forEach((ch) => {\n\t\t\t\t\t\tconst c = ch as TextChannel | VoiceChannel;\n\t\t\t\t\t\tinteraction.guild?.roles.cache.forEach(\n\t\t\t\t\t\t\tasync (role) =>\n\t\t\t\t\t\t\t\tawait c.permissionOverwrites.edit(role.id, {\n\t\t\t\t\t\t\t\t\tSendMessages: true,\n\t\t\t\t\t\t\t\t}),\n\t\t\t\t\t\t);\n\t\t\t\t\t});\n\n\t\t\t\t\tawait interaction.editReply({\n\t\t\t\t\t\tembeds: [successEmbedBuilder(\"Lockdown is now off.\")],\n\t\t\t\t\t});\n\t\t\t\t} catch {\n\t\t\t\t\tawait interaction.editReply(defaultError);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase \"update\":\n\t\t\t\tconst content = interaction.options.getString(\"message\");\n\n\t\t\t\tawait interaction.deferReply({ ephemeral: true });\n\n\t\t\t\ttry {\n\t\t\t\t\tconst guild = await prisma.guild.findUnique({\n\t\t\t\t\t\twhere: {\n\t\t\t\t\t\t\tguild: interaction.guildId,\n\t\t\t\t\t\t},\n\t\t\t\t\t\tselect: {\n\t\t\t\t\t\t\tlockdownMessage: true,\n\t\t\t\t\t\t\tlockdownChannel: true,\n\t\t\t\t\t\t},\n\t\t\t\t\t});\n\n\t\t\t\t\tif (!(guild?.lockdownChannel || guild?.lockdownMessage)) {\n\t\t\t\t\t\tawait interaction.editReply({\n\t\t\t\t\t\t\tembeds: [\n\t\t\t\t\t\t\t\terrorEmbedBuilder(\n\t\t\t\t\t\t\t\t\t\"lockdown has not been activated in this server!\",\n\t\t\t\t\t\t\t\t),\n\t\t\t\t\t\t\t],\n\t\t\t\t\t\t});\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\n\t\t\t\t\tconst channel = interaction.guild?.channels.cache.get(\n\t\t\t\t\t\tguild?.lockdownChannel ?? \"\",\n\t\t\t\t\t) as TextChannel | VoiceChannel | null;\n\t\t\t\t\tconst message = await channel?.messages?.fetch(\n\t\t\t\t\t\tguild?.lockdownMessage ?? \"\",\n\t\t\t\t\t);\n\n\t\t\t\t\tconst embed = message?.embeds[0];\n\n\t\t\t\t\tconst newEmbed = { ...embed?.data };\n\t\t\t\t\tnewEmbed.fields ??= [];\n\t\t\t\t\tnewEmbed.fields.push({\n\t\t\t\t\t\tname: `${emojis.arrow} Update #${(embed?.fields?.length ?? 0) + 1}`,\n\t\t\t\t\t\tvalue: `${emojis.blank} ${content}`,\n\t\t\t\t\t});\n\t\t\t\t\tnewEmbed.timestamp = new Date().toISOString();\n\n\t\t\t\t\tawait message?.edit({ embeds: [newEmbed] });\n\t\t\t\t} catch {\n\t\t\t\t\tawait interaction.editReply(defaultError);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tawait interaction.editReply({\n\t\t\t\t\tembeds: [\n\t\t\t\t\t\tsuccessEmbedBuilder(\"Successfully posted the lockdown update!\"),\n\t\t\t\t\t],\n\t\t\t\t});\n\t\t\t\tbreak;\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": ["_a"]
}
