{
  "version": 3,
  "sources": ["../../events/antiToxicityUpdate.ts"],
  "sourcesContent": ["import type { Message, TextChannel } from \"discord.js\";\nimport { Events, EmbedBuilder } from \"discord.js\";\nimport prisma from \"../database.js\";\nimport { analyzeText } from \"../utils.js\";\n\nexport default class AntiToxicity {\n\tname = Events.MessageUpdate;\n\n\tasync run(_: Message, message: Message) {\n\t\tif (!message.inGuild()) return;\n\t\tif (message.author.id === message.client.user?.id) return;\n\t\tif (message.author.bot) return;\n\n\t\ttry {\n\t\t\tconst guild = await prisma.guild.findUnique({\n\t\t\t\twhere: { guild: message.guildId },\n\t\t\t\tselect: { logs: true, toxicityFilter: true },\n\t\t\t});\n\n\t\t\tconst level = await analyzeText(message.content);\n\t\t\tconst danger = Math.ceil(level);\n\n\t\t\tconst user = await prisma.user.findUnique({\n\t\t\t\twhere: { user: message.author.id },\n\t\t\t\tselect: { toxicity: true },\n\t\t\t});\n\n\t\t\tif (danger < 20) {\n\t\t\t\tawait prisma.user.upsert({\n\t\t\t\t\twhere: { user: message.author.id },\n\t\t\t\t\tupdate: { toxicity: { decrement: 0.2 } },\n\t\t\t\t\tcreate: { user: message.author.id },\n\t\t\t\t});\n\t\t\t\tif ((user?.toxicity ?? 0) - 0.2 <= 0) {\n\t\t\t\t\tawait prisma.user.upsert({\n\t\t\t\t\t\twhere: { user: message.author.id },\n\t\t\t\t\t\tupdate: { toxicity: 0 },\n\t\t\t\t\t\tcreate: { user: message.author.id },\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t} else if (danger > 80) {\n\t\t\t\tif (!guild?.toxicityFilter) return;\n\t\t\t\tawait prisma.user.upsert({\n\t\t\t\t\twhere: { user: message.author.id },\n\t\t\t\t\tupdate: { toxicity: { increment: 2.5 } },\n\t\t\t\t\tcreate: { user: message.author.id, toxicity: 2.5 },\n\t\t\t\t});\n\t\t\t\tif ((user?.toxicity ?? 0) + 2.5 >= 100) {\n\t\t\t\t\tawait prisma.user.upsert({\n\t\t\t\t\t\twhere: { user: message.author.id },\n\t\t\t\t\t\tupdate: { toxicity: 2.5 },\n\t\t\t\t\t\tcreate: { user: message.author.id, toxicity: 2.5 },\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (!guild?.toxicityFilter) return;\n\t\t\tif (danger < 90) return;\n\n\t\t\tawait message.delete();\n\t\t\tconst embed = new EmbedBuilder({\n\t\t\t\tauthor: {\n\t\t\t\t\tname: message.author.tag,\n\t\t\t\t\ticon_url: message.author.displayAvatarURL(),\n\t\t\t\t},\n\t\t\t\ttitle: \"Toxic message detected!\",\n\t\t\t\tdescription: `\nA user was detected being toxic in a channel, here are the details below:\n    \n    <:arrow:1068604670764916876> **Message:** ||${message.content}||  \n    <:arrow:1068604670764916876> **Channel:** ${message.channel} \n<:arrow:1068604670764916876> **Reason:** toxicity`,\n\t\t\t\tcolor: 0x2b2d31,\n\t\t\t\tfooter: {\n\t\t\t\t\ttext: message.guild?.name ?? \"\",\n\t\t\t\t\ticon_url: message.guild?.iconURL() ?? \"\",\n\t\t\t\t},\n\t\t\t\ttimestamp: new Date().toISOString(),\n\t\t\t});\n\n\t\t\tconst logs = message.guild.channels.cache.get(\n\t\t\t\tguild?.logs ?? \"\",\n\t\t\t) as TextChannel | null;\n\n\t\t\tawait logs?.send({ embeds: [embed] });\n\t\t} catch {\n\t\t\treturn;\n\t\t}\n\t}\n}\n"],
  "mappings": ";AACA,SAAS,QAAQ,oBAAoB;AACrC,OAAO,YAAY;AACnB,SAAS,mBAAmB;AAE5B,qBAAqB,aAAa;AAAA,EACjC,OAAO,OAAO;AAAA,EAEd,MAAM,IAAI,GAAY,SAAkB;AARzC;AASE,QAAI,CAAC,QAAQ,QAAQ;AAAG;AACxB,QAAI,QAAQ,OAAO,SAAO,aAAQ,OAAO,SAAf,mBAAqB;AAAI;AACnD,QAAI,QAAQ,OAAO;AAAK;AAExB,QAAI;AACH,YAAM,QAAQ,MAAM,OAAO,MAAM,WAAW;AAAA,QAC3C,OAAO,EAAE,OAAO,QAAQ,QAAQ;AAAA,QAChC,QAAQ,EAAE,MAAM,MAAM,gBAAgB,KAAK;AAAA,MAC5C,CAAC;AAED,YAAM,QAAQ,MAAM,YAAY,QAAQ,OAAO;AAC/C,YAAM,SAAS,KAAK,KAAK,KAAK;AAE9B,YAAM,OAAO,MAAM,OAAO,KAAK,WAAW;AAAA,QACzC,OAAO,EAAE,MAAM,QAAQ,OAAO,GAAG;AAAA,QACjC,QAAQ,EAAE,UAAU,KAAK;AAAA,MAC1B,CAAC;AAED,UAAI,SAAS,IAAI;AAChB,cAAM,OAAO,KAAK,OAAO;AAAA,UACxB,OAAO,EAAE,MAAM,QAAQ,OAAO,GAAG;AAAA,UACjC,QAAQ,EAAE,UAAU,EAAE,WAAW,IAAI,EAAE;AAAA,UACvC,QAAQ,EAAE,MAAM,QAAQ,OAAO,GAAG;AAAA,QACnC,CAAC;AACD,cAAK,6BAAM,aAAY,KAAK,OAAO,GAAG;AACrC,gBAAM,OAAO,KAAK,OAAO;AAAA,YACxB,OAAO,EAAE,MAAM,QAAQ,OAAO,GAAG;AAAA,YACjC,QAAQ,EAAE,UAAU,EAAE;AAAA,YACtB,QAAQ,EAAE,MAAM,QAAQ,OAAO,GAAG;AAAA,UACnC,CAAC;AAAA,QACF;AAAA,MACD,WAAW,SAAS,IAAI;AACvB,YAAI,EAAC,+BAAO;AAAgB;AAC5B,cAAM,OAAO,KAAK,OAAO;AAAA,UACxB,OAAO,EAAE,MAAM,QAAQ,OAAO,GAAG;AAAA,UACjC,QAAQ,EAAE,UAAU,EAAE,WAAW,IAAI,EAAE;AAAA,UACvC,QAAQ,EAAE,MAAM,QAAQ,OAAO,IAAI,UAAU,IAAI;AAAA,QAClD,CAAC;AACD,cAAK,6BAAM,aAAY,KAAK,OAAO,KAAK;AACvC,gBAAM,OAAO,KAAK,OAAO;AAAA,YACxB,OAAO,EAAE,MAAM,QAAQ,OAAO,GAAG;AAAA,YACjC,QAAQ,EAAE,UAAU,IAAI;AAAA,YACxB,QAAQ,EAAE,MAAM,QAAQ,OAAO,IAAI,UAAU,IAAI;AAAA,UAClD,CAAC;AAAA,QACF;AAAA,MACD;AAEA,UAAI,EAAC,+BAAO;AAAgB;AAC5B,UAAI,SAAS;AAAI;AAEjB,YAAM,QAAQ,OAAO;AACrB,YAAM,QAAQ,IAAI,aAAa;AAAA,QAC9B,QAAQ;AAAA,UACP,MAAM,QAAQ,OAAO;AAAA,UACrB,UAAU,QAAQ,OAAO,iBAAiB;AAAA,QAC3C;AAAA,QACA,OAAO;AAAA,QACP,aAAa;AAAA;AAAA;AAAA,kDAGiC,QAAQ,OAAO;AAAA,gDACjB,QAAQ,OAAO;AAAA;AAAA,QAE3D,OAAO;AAAA,QACP,QAAQ;AAAA,UACP,QAAM,aAAQ,UAAR,mBAAe,SAAQ;AAAA,UAC7B,YAAU,aAAQ,UAAR,mBAAe,cAAa;AAAA,QACvC;AAAA,QACA,YAAW,oBAAI,KAAK,GAAE,YAAY;AAAA,MACnC,CAAC;AAED,YAAM,OAAO,QAAQ,MAAM,SAAS,MAAM;AAAA,SACzC,+BAAO,SAAQ;AAAA,MAChB;AAEA,aAAM,6BAAM,KAAK,EAAE,QAAQ,CAAC,KAAK,EAAE;AAAA,IACpC,QAAQ;AACP;AAAA,IACD;AAAA,EACD;AACD;",
  "names": []
}
