{
  "version": 3,
  "sources": ["../../commands/passport.ts"],
  "sourcesContent": ["import type { CommandInteraction } from 'discord.js';\nimport { SlashCommandBuilder, AttachmentBuilder } from 'discord.js';\nimport sharp from 'sharp';\nimport { loadImage, defaultError } from '../utils.js';\nimport dayjs from 'dayjs';\nimport relativeTime from 'dayjs/plugin/relativeTime.js';\nimport { join } from 'node:path';\nimport prisma from '../database.js';\n\ndayjs.extend(relativeTime);\n\nexport default class Info {\n\tdata = new SlashCommandBuilder()\n\t\t.setName('passport')\n\t\t.setNameLocalizations({ 'es-ES': 'pasaporte' })\n\t\t.setDescription('A card with all important info of a user.')\n\t\t.setDescriptionLocalizations({ 'es-ES': 'Una tarjeta con toda la informacion importante de un usuario.' })\n\t\t.addUserOption(option =>\n\t\t\toption\n\t\t\t\t.setName('user')\n\t\t\t\t.setNameLocalizations({ 'es-ES': 'usuario' })\n\t\t\t\t.setDescription('You can pass a mention or an id of a user.')\n\t\t\t\t.setDescriptionLocalizations({ 'es-ES': 'Puedes pasar una menci\u00F3n o un id de un usuario' })\n\t\t);\n\n\tasync run(interaction: CommandInteraction) {\n\t\tconst user = interaction.options.getUser('user') ?? interaction.user;\n\n\t\tif (user.bot) {\n\t\t\tawait interaction.reply({ content: '<:error:1009134465995509810> | **You cannot get reports for a bot**', ephemeral: true });\n\t\t\treturn;\n\t\t}\n\n\t\tawait interaction.deferReply();\n\n\t\ttry {\n\t\t\tconst avatarBuffer = await loadImage(user.displayAvatarURL());\n\n\t\t\tconst roundedCorners = Buffer.from(`\n\t\t\t\t<svg>\n\t\t\t\t\t<rect x=\"0\" y=\"0\" width=\"128\" height=\"128\" rx=\"50%\" ry=\"50%\"/>\n\t\t\t\t</svg>\n\t \t\t`);\n\n\t\t\tconst toxicityUser = await prisma.user.findUnique({\n\t\t\t\twhere: { user: user.id },\n\t\t\t\tselect: { toxicity: true, reports: true, warns: true },\n\t\t\t});\n\n\t\t\tconst toxicity = toxicityUser?.toxicity?.toFixed(2);\n\t\t\tconst username = Buffer.from(`\n\t\t\t\t<svg width=\"618\" height=\"437\">\n\t \t\t\t\t<style>\n\t\t \t\t\t\t.name {\n\t\t\t\t\t\t\tfont-size: ${user.tag.length > 25 ? '20' : user.tag.length > 22 ? '22' : '25'}px;\n\t\t\t\t\t\t\tfont-family: sans-serif;\n\t\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\t\tfill: #fff;\n\t\t\t\t\t\t}\n\n\t \t\t\t\t\t.tag {\n\t\t\t\t\t\t\tfont-size: 20px;\n\t\t\t\t\t\t\tfont-family: sans-serif;\n\t\t\t\t\t\t\tfont-weight: bold;\n\t\t\t\t\t\t\tfill: #bdbdbd;\n\t\t\t\t\t\t}\n\t \t\t\t\t</style>\n\t\t \t \t\t<text x=\"40\" y=\"140\" class=\"name\">\n\t\t\t\t\t\t${user.username}<tspan class=\"tag\">#${user.discriminator}</tspan>\n\t\t \t\t\t</text>\n\t\t\t\t\t<text x=\"410\" y=\"140\" class=\"name\">\n\t\t\t\t\t\t<tspan class=\"tag\">Danger:</tspan> ${\n\t\t\t\t\t\t\t(toxicity?.endsWith('00') ? toxicity?.slice(0, -3) : toxicity?.endsWith('0') ? toxicity?.slice(0, -1) : toxicity) ?? 0\n\t\t\t\t\t\t}%\n\t\t \t\t\t</text>\n\t\t\t\t\t<text x=\"410\" y=\"180\" class=\"name\">\n\t\t\t\t\t\t<tspan class=\"tag\">Warnings:</tspan> ${toxicityUser?.warns?.length ?? 0}\n\t\t \t\t\t</text>\n\t\t\t\t\t<text x=\"410\" y=\"220\" class=\"name\">\n\t\t\t\t\t\t<tspan class=\"tag\">Reports:</tspan> ${toxicityUser?.reports?.length ?? 0}\n\t\t \t\t\t</text>\n\t\t\t\t\t<text x=\"40\" y=\"180\" class=\"tag\">Created ${dayjs(user.createdAt).fromNow()}</text>\n\t\t\t\t</svg>\n \t\t\t`);\n\n\t\t\tconst circle = Buffer.from(`\n\t \t\t\t<svg>\n\t\t\t\t\t<rect x=\"0\" y=\"0\" width=\"158\" height=\"158\" rx=\"50%\" ry=\"50%\" fill=\"#0000f5\"/>\n\t\t\t\t</svg>\n\t \t\t`);\n\n\t\t\tconst avatarRoundedBuffer = await sharp(avatarBuffer)\n\t\t\t\t.resize(128, 128)\n\t\t\t\t.composite([\n\t\t\t\t\t{\n\t\t\t\t\t\tinput: roundedCorners,\n\t\t\t\t\t\tblend: 'dest-in',\n\t\t\t\t\t},\n\t\t\t\t])\n\t\t\t\t.png()\n\t\t\t\t.toBuffer();\n\n\t\t\tconst avatarBorderBuffer = await sharp(circle)\n\t\t\t\t.composite([\n\t\t\t\t\t{\n\t\t\t\t\t\tinput: avatarRoundedBuffer,\n\t\t\t\t\t},\n\t\t\t\t])\n\t\t\t\t.png()\n\t\t\t\t.toBuffer();\n\n\t\t\tconst image = await sharp({\n\t\t\t\tcreate: {\n\t\t\t\t\tchannels: 4,\n\t\t\t\t\twidth: 618,\n\t\t\t\t\theight: 537,\n\t\t\t\t\tbackground: { r: 0, g: 0, b: 0, alpha: 0 },\n\t\t\t\t},\n\t\t\t})\n\t\t\t\t.composite([\n\t\t\t\t\t{\n\t\t\t\t\t\tinput: join(process.cwd(), './assets/background.png'),\n\t\t\t\t\t},\n\t\t\t\t\t{\n\t\t\t\t\t\tinput: avatarBorderBuffer,\n\t\t\t\t\t\ttop: 0,\n\t\t\t\t\t\tleft: 60,\n\t\t\t\t\t},\n\t\t\t\t\t{ input: username },\n\t\t\t\t])\n\t\t\t\t.png()\n\t\t\t\t.toBuffer();\n\n\t\t\tawait interaction.editReply({ files: [new AttachmentBuilder(image, { name: 'card.png' })] });\n\t\t} catch (e) {\n\t\t\tconsole.error(e);\n\t\t\tawait interaction.editReply(defaultError);\n\t\t}\n\t}\n}\n"],
  "mappings": "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",
  "names": []
}
