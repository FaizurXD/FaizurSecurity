{
  "version": 3,
  "sources": ["../../events/kick.ts"],
  "sourcesContent": ["import type { GuildMember, TextChannel } from 'discord.js';\nimport { Events, AuditLogEvent, PermissionFlagsBits } from 'discord.js';\nimport { logBuilder } from '../utils.js';\nimport prisma from '../database.js';\n\nexport default class Kick {\n\tname = Events.GuildMemberRemove;\n\n\tstatic times = 0;\n\n\tasync run(member: GuildMember) {\n\t\tconst guild = await prisma.guild.findUnique({\n\t\t\twhere: { guild: member.guild.id },\n\t\t\tselect: { antiRaid: true },\n\t\t});\n\n\t\tif (!guild?.antiRaid) return;\n\n\t\tKick.times++;\n\n\t\tif (Kick.times >= 5) {\n\t\t\tconst auditLogFetch = await member.guild.fetchAuditLogs({ limit: 1, type: AuditLogEvent.MemberKick });\n\t\t\tconst log = auditLogFetch.entries.first();\n\t\t\tif (!log) return;\n\t\t\tif (log.createdAt < member.joinedAt!) return;\n\t\t\tif (member.client.user?.id === log.executor?.id) return;\n\t\t\tconst executor = await member.guild.members.fetch(log?.executor?.id!);\n\t\t\texecutor.guild.roles.cache\n\t\t\t\t.filter(r => r.permissions.has(PermissionFlagsBits.Administrator))\n\t\t\t\t.forEach(\n\t\t\t\t\tasync r =>\n\t\t\t\t\t\tawait executor.roles\n\t\t\t\t\t\t\t.remove(r, 'Kicking too many users')\n\t\t\t\t\t\t\t.catch(async () => await r.setPermissions([], 'Kicking too many users').catch(() => {}))\n\t\t\t\t);\n\n\t\t\tconst guild = await prisma.guild.findUnique({\n\t\t\t\twhere: { guild: member.guild.id },\n\t\t\t\tselect: { logs: true },\n\t\t\t});\n\n\t\t\tconst logs = member.guild?.channels.cache.get(guild?.logs!) as TextChannel;\n\t\t\tawait logs?.send(\n\t\t\t\tlogBuilder({\n\t\t\t\t\tmember,\n\t\t\t\t\tcontent: `${member.user} has been demoted for kicking too many users.`,\n\t\t\t\t\treason: `Too many users kicked.`,\n\t\t\t\t})\n\t\t\t);\n\t\t}\n\n\t\tsetTimeout(() => {\n\t\t\tKick.times = 0;\n\t\t}, 8000);\n\t}\n}\n"],
  "mappings": "AACA,SAAS,QAAQ,eAAe,2BAA2B;AAC3D,SAAS,kBAAkB;AAC3B,OAAO,YAAY;AAEnB,MAAqB,QAArB,MAA0B;AAAA,EAA1B;AACC,gBAAO,OAAO;AAAA;AAAA,EAId,MAAM,IAAI,QAAqB;AAVhC;AAWE,UAAM,QAAQ,MAAM,OAAO,MAAM,WAAW;AAAA,MAC3C,OAAO,EAAE,OAAO,OAAO,MAAM,GAAG;AAAA,MAChC,QAAQ,EAAE,UAAU,KAAK;AAAA,IAC1B,CAAC;AAED,QAAI,EAAC,+BAAO;AAAU;AAEtB,UAAK;AAEL,QAAI,MAAK,SAAS,GAAG;AACpB,YAAM,gBAAgB,MAAM,OAAO,MAAM,eAAe,EAAE,OAAO,GAAG,MAAM,cAAc,WAAW,CAAC;AACpG,YAAM,MAAM,cAAc,QAAQ,MAAM;AACxC,UAAI,CAAC;AAAK;AACV,UAAI,IAAI,YAAY,OAAO;AAAW;AACtC,YAAI,YAAO,OAAO,SAAd,mBAAoB,UAAO,SAAI,aAAJ,mBAAc;AAAI;AACjD,YAAM,WAAW,MAAM,OAAO,MAAM,QAAQ,OAAM,gCAAK,aAAL,mBAAe,EAAG;AACpE,eAAS,MAAM,MAAM,MACnB,OAAO,OAAK,EAAE,YAAY,IAAI,oBAAoB,aAAa,CAAC,EAChE;AAAA,QACA,OAAM,MACL,MAAM,SAAS,MACb,OAAO,GAAG,wBAAwB,EAClC,MAAM,YAAY,MAAM,EAAE,eAAe,CAAC,GAAG,wBAAwB,EAAE,MAAM,MAAM;AAAA,QAAC,CAAC,CAAC;AAAA,MAC1F;AAED,YAAMA,SAAQ,MAAM,OAAO,MAAM,WAAW;AAAA,QAC3C,OAAO,EAAE,OAAO,OAAO,MAAM,GAAG;AAAA,QAChC,QAAQ,EAAE,MAAM,KAAK;AAAA,MACtB,CAAC;AAED,YAAM,QAAO,YAAO,UAAP,mBAAc,SAAS,MAAM,IAAIA,UAAA,gBAAAA,OAAO;AACrD,aAAM,6BAAM;AAAA,QACX,WAAW;AAAA,UACV;AAAA,UACA,SAAS,GAAG,OAAO;AAAA,UACnB,QAAQ;AAAA,QACT,CAAC;AAAA;AAAA,IAEH;AAEA,eAAW,MAAM;AAChB,YAAK,QAAQ;AAAA,IACd,GAAG,GAAI;AAAA,EACR;AACD;AAlDA,IAAqB,OAArB;AAAqB,KAGb,QAAQ;AAHhB;AAAA,EAAO,QALP;AAAA;",
  "names": ["guild"]
}
